<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings</title>
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self' http://localhost:11434;">
    <style>
        :root {
            --ink-black: #002029ff;
            --jet-black: #00303dff;
            --dark-teal: #004052ff;
            --dark-teal-2: #005066ff;
            --dark-teal-3: #00607aff;

            --bg-color: var(--ink-black);
            --sidebar-color: var(--jet-black);
            --text-color: #e0e0e0;
            --accent-color: var(--dark-teal-3);
            --border-color: var(--dark-teal);
            --input-bg: var(--jet-black);
            --hover-color: var(--dark-teal);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            height: 100vh;
            display: flex;
            user-select: none;
            overflow: hidden;
        }

        /* SIDEBAR */
        #sidebar {
            width: 150px;
            background-color: var(--sidebar-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding-top: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            cursor: pointer;
            color: #888;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tab-btn:hover {
            color: white;
            background-color: var(--hover-color);
        }

        .tab-btn.active {
            color: white;
            background-color: var(--ink-black);
            border-left: 3px solid var(--accent-color);
            padding-left: 17px;
        }

        /* CONTENT */
        #content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .sub-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 8px;
            display: block;
        }

        /* CONTROLS */
        input[type="text"],
        select {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: white;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        input[type="text"]:focus,
        select:focus {
            outline: 2px solid var(--accent-color);
            border-color: transparent;
        }

        /* TOGGLE SWITCH */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent-color);
        }

        input:focus+.slider {
            box-shadow: 0 0 1px var(--accent-color);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* BUTTONS */
        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn:hover {
            filter: brightness(1.1);
        }

        .btn-secondary {
            background-color: var(--dark-teal);
        }

        .btn-danger {
            background-color: #dc2626;
        }

        .btn-danger:hover {
            background-color: #b91c1c;
        }

        /* HOTKEY INPUT */
        .hotkey-display-box {
            background: #111;
            padding: 10px;
            text-align: center;
            border: 1px dashed #555;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
            font-size: 1.2em;
        }

        .hotkey-display-box.recording {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: var(--dark-teal);
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: var(--jet-black);
            border: 1px solid var(--accent-color);
            padding: 30px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .modal h3 {
            margin-top: 0;
            color: #fca311;
        }

        .modal p {
            color: #ccc;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* WARNING BANNER */
        #restart-banner {
            display: none;
            background: #4a3400;
            border-left: 4px solid #fca311;
            padding: 12px 20px;
            margin: -30px -30px 20px -30px;
            align-items: center;
            justify-content: space-between;
        }

        #restart-banner .msg {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #ffcc00;
        }
    </style>
</head>

<body>
    <div id="sidebar">
        <div class="tab-btn active" data-tab="general">General</div>
        <div class="tab-btn" data-tab="audio">Audio</div>
        <div class="tab-btn" data-tab="ollama">Ollama</div>
        <div class="tab-btn" data-tab="modes">Modes</div>
        <div class="tab-btn" data-tab="apikeys">API Keys</div>
        <div class="tab-btn" data-tab="about">About</div>
    </div>



    <div id="content">
        <!-- Restart Warning Banner -->
        <div id="restart-banner">
            <div class="msg">
                <span>‚ö†Ô∏è Restart Required to Apply Model Changes</span>
            </div>
            <button id="restart-now-banner-btn" class="btn"
                style="background: #fca311; color: black; font-weight: bold;">Restart Now</button>
        </div>

        <!-- GENERAL TAB -->
        <div id="general" class="tab-content active">
            <h2>General Settings</h2>

            <!-- 1. Processing Mode -->
            <div class="setting-group">
                <div class="setting-row">
                    <div>
                        <label>Startup Processing Mode</label>
                        <span class="sub-label">Choose how your voice is processed at startup (can be toggled in the
                            dashboard)</span>
                    </div>
                    <select id="processing-mode">
                        <option value="local">üè† Local (Offline, Confidential)</option>
                        <option value="cloud">‚òÅÔ∏è Cloud (Faster, Paid)</option>
                        <option value="google">üîê Google Login (Your Account)</option>
                    </select>
                </div>
            </div>

            <!-- 2. Default AI Model -->
            <div class="setting-group">
                <label>Default AI Model</label>
                <span class="sub-label">Model used for local text processing</span>
                <select id="default-model">
                    <option value="">Loading models...</option>
                </select>
                <div id="model-change-status"
                    style="display: none; margin-top: 8px; padding: 8px 12px; background: #1a3a1a; border: 1px solid #22c55e; border-radius: 4px; color: #4ade80;">
                    ‚úì Model updated!
                </div>
            </div>

            <!-- 3. Hotkeys Section -->
            <div style="border-top: 1px solid var(--border-color); margin: 20px 0; padding-top: 20px;">
                <h3 style="font-size: 0.95rem; color: #aaa; margin: 0 0 15px 0;">HOTKEYS</h3>

                <!-- Dictate Hotkey -->
                <div class="setting-group">
                    <label>Dictate Hotkey</label>
                    <span class="sub-label">Press to start/stop dictation (transcribe ‚Üí clean ‚Üí type)</span>
                    <div id="hotkey-display" class="hotkey-display-box">Ctrl + Alt + D
                    </div>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn btn-secondary" id="reset-hotkey-dictate">Reset Default</button>
                    </div>
                </div>

                <!-- Ask Mode Hotkey -->
                <div class="setting-group">
                    <label>Ask Mode Hotkey</label>
                    <span class="sub-label">Press to ask questions (transcribe ‚Üí LLM answer ‚Üí type/clipboard)</span>
                    <div id="ask-hotkey-display" class="hotkey-display-box">Ctrl + Alt + A
                    </div>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn btn-secondary" id="reset-hotkey-ask">Reset Default</button>
                    </div>
                </div>

                <!-- Translate Hotkey -->
                <div class="setting-group">
                    <label>Translate Hotkey</label>
                    <span class="sub-label">Press to start listening for bidirectional translation (ES ‚Üî EN)</span>
                    <div id="translate-hotkey-display" class="hotkey-display-box">
                        Ctrl + Alt + T
                    </div>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn btn-secondary" id="reset-hotkey-translate">Reset Default</button>
                    </div>
                </div>

                <!-- Refine Hotkey -->
                <div class="setting-group">
                    <label>Refine Hotkey</label>
                    <span class="sub-label">Select text and press to refine/fix grammar in-place</span>
                    <div id="refine-hotkey-display" class="hotkey-display-box">
                        Ctrl + Alt + R
                    </div>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn btn-secondary" id="reset-hotkey-refine">Reset Default</button>
                    </div>
                </div>

                <!-- Oops Hotkey -->
                <div class="setting-group">
                    <label>Oops (Re-inject) Hotkey</label>
                    <span class="sub-label">Press to re-type the last dictation text (if focus was lost)</span>
                    <div id="oops-hotkey-display" class="hotkey-display-box">
                        Ctrl + Alt + V
                    </div>
                    <div style="text-align: right; margin-top: 5px;">
                        <button class="btn btn-secondary" id="reset-hotkey-oops">Reset Default</button>
                    </div>
                </div>
            </div>

            <!-- 4. Start at Login -->
            <div class="setting-group">
                <div class="setting-row">
                    <div>
                        <label>Start at Login</label>
                        <span class="sub-label">Launch dIKtate when Windows starts</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="auto-start">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>


        <!-- AUDIO TAB -->
        <div id="audio" class="tab-content">
            <h2>Audio Settings</h2>

            <div class="setting-group">
                <label>Input Device</label>
                <select id="audio-device">
                    <option>Default Microphone</option>
                </select>
            </div>

            <div class="setting-group" id="sound-settings-group">
                <label>Sound Effects</label>
                <span class="sub-label">Choose sounds for different recording states</span>

                <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
                    <!-- Start Sound -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="width: 100px; font-size: 0.9em; color: #888;">üèÅ Start:</span>
                        <select id="start-sound" style="flex: 1;">
                            <option value="none">üîá None (Silent)</option>
                        </select>
                        <button class="btn btn-secondary" style="padding: 4px 10px;" id="preview-start-sound">‚ñ∂</button>
                    </div>

                    <!-- Stop Sound -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="width: 100px; font-size: 0.9em; color: #888;">üõë Stop:</span>
                        <select id="stop-sound" style="flex: 1;">
                            <option value="none">üîá None (Silent)</option>
                        </select>
                        <button class="btn btn-secondary" style="padding: 4px 10px;" id="preview-stop-sound">‚ñ∂</button>
                    </div>

                    <!-- Ask Sound -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="width: 100px; font-size: 0.9em; color: #888;">‚ùì Ask:</span>
                        <select id="ask-sound" style="flex: 1;">
                            <option value="none">üîá None (Silent)</option>
                        </select>
                        <button class="btn btn-secondary" style="padding: 4px 10px;" id="preview-ask-sound">‚ñ∂</button>
                    </div>
                </div>
            </div>


            <div class="setting-group">
                <div class="setting-row">
                    <div>
                        <label>Noise Reduction <span
                                style="font-size: 0.7em; background: #444; padding: 2px 6px; border-radius: 3px; margin-left: 8px;">Coming
                                Soon</span></label>
                        <span class="sub-label">Filter background noise from recordings</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="noise-reduction" disabled>
                        <span class="slider" style="opacity: 0.5;"></span>
                    </label>
                </div>
            </div>

            <div class="setting-group">
                <label>Maximum Recording Duration</label>
                <span class="sub-label">Auto-stop recording after this duration (prevents runaway recordings)</span>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <label style="flex: 1;">
                        <input type="radio" name="max-duration" value="30">
                        <span style="margin-left: 5px;">30 seconds</span>
                    </label>
                    <label style="flex: 1;">
                        <input type="radio" name="max-duration" value="60" checked>
                        <span style="margin-left: 5px;">1 minute</span>
                    </label>
                    <label style="flex: 1;">
                        <input type="radio" name="max-duration" value="120">
                        <span style="margin-left: 5px;">2 minutes</span>
                    </label>
                    <label style="flex: 1;">
                        <input type="radio" name="max-duration" value="0">
                        <span style="margin-left: 5px;">‚ö†Ô∏è Unlimited</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- OLLAMA TAB -->
        <div id="ollama" class="tab-content">
            <h2>ü¶ô Ollama Management</h2>

            <!-- Hardware Performance -->
            <div class="setting-group">
                <label>Hardware Performance</label>
                <span class="sub-label">Detect your GPU and VRAM to see recommended models</span>
                <div id="hardware-status-panel"
                    style="background: #1a1a1a; padding: 12px; border-radius: 6px; margin: 10px 0; border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #888;">GPU:</span>
                        <span id="hw-gpu">Unknown</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #888;">VRAM:</span>
                        <span id="hw-vram">Unknown</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #888;">Performance Tier:</span>
                        <span id="hw-tier" style="font-weight: bold;">Unknown</span>
                    </div>
                </div>
                <button id="hardware-test-btn" class="btn btn-secondary">üî¨ Run Hardware Test</button>
            </div>

            <!-- Service Status -->
            <div class="setting-group">
                <label>Service Status</label>
                <span class="sub-label">Local LLM inference engine</span>
                <div id="ollama-status-panel"
                    style="background: #1a1a1a; padding: 12px; border-radius: 6px; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #888;">Status:</span>
                        <span id="ollama-service-status">Checking...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #888;">Version:</span>
                        <span id="ollama-service-version">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #888;">Models Loaded:</span>
                        <span id="ollama-loaded-models">--</span>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button id="refresh-ollama-btn" class="btn btn-secondary">üîÑ Refresh</button>
                    <button id="browse-models-link" class="btn btn-secondary">üìö Browse Models</button>
                </div>
            </div>

            <!-- Service Control -->
            <div class="setting-group">
                <label>Service Control</label>
                <span class="sub-label">Restart Ollama to clear memory and reload models</span>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button id="restart-ollama-btn" class="btn btn-secondary">üîÑ Restart Ollama</button>
                    <button id="warmup-btn" class="btn btn-secondary">üî• Warm Up Current Model</button>
                </div>
                <div id="ollama-restart-status" style="margin-top: 8px; font-size: 0.9em; color: #888;"></div>
            </div>

            <!-- Model Management -->
            <div class="setting-group">
                <label>Pull New Model</label>
                <span class="sub-label">Download a model from the Ollama registry</span>

                <!-- Quick picks for popular models -->
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin: 10px 0;">
                    <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85em;"
                        data-quick-pull="gemma3:4b">gemma3:4b</button>
                    <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85em;"
                        data-quick-pull="llama3.2:3b">llama3.2:3b</button>
                    <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85em;"
                        data-quick-pull="phi3:mini">phi3:mini</button>
                    <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85em;"
                        data-quick-pull="qwen2.5:3b">qwen2.5:3b</button>
                    <button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.85em;"
                        data-quick-pull="mistral:7b">mistral:7b</button>
                </div>

                <div style="display: flex; gap: 10px;">
                    <input type="text" id="ollama-pull-model" placeholder="Or type model name..." style="flex: 1;">
                    <button id="pull-model-btn" class="btn btn-secondary">‚¨áÔ∏è Pull</button>
                </div>
                <div id="ollama-pull-status" style="margin-top: 8px; font-size: 0.9em; color: #888;"></div>
            </div>


            <div class="setting-group">
                <label>Installed Models</label>
                <span class="sub-label">Manage your downloaded models</span>
                <div id="ollama-models-list"
                    style="background: #1a1a1a; padding: 12px; border-radius: 6px; margin: 10px 0; max-height: 200px; overflow-y: auto;">
                    Loading...
                </div>
            </div>

            <!-- Performance Settings -->
            <div class="setting-group">
                <label>Keep-Alive Duration</label>
                <span class="sub-label">How long to keep models loaded in memory after use</span>
                <select id="keep-alive-select">
                    <option value="5m">5 minutes</option>
                    <option value="10m" selected>10 minutes (default)</option>
                    <option value="30m">30 minutes</option>
                    <option value="1h">1 hour</option>
                    <option value="24h">24 hours (always loaded)</option>
                </select>
            </div>

            <!-- Advanced -->
            <div class="setting-group">
                <label>Ollama Server URL</label>
                <span class="sub-label">Change if running Ollama on a remote machine</span>
                <input type="text" id="server-url-input" value="http://localhost:11434" style="width: 100%;">
            </div>
        </div>


        <!-- MODES TAB -->
        <div id="modes" class="tab-content">
            <h2>Execution Modes</h2>

            <div class="setting-group">
                <label>Default Mode</label>
                <span class="sub-label">Mode used when you start dictating</span>
                <select id="default-mode-select">
                    <option value="standard">Standard (General Purpose)</option>
                    <option value="prompt">Prompt (For LLM Prompts)</option>
                    <option value="professional">Professional (Business)</option>
                    <option value="raw">Raw (Literal, Minimal)</option>
                </select>
            </div>


            <!-- Ask Mode Output -->
            <div class="setting-group">
                <label>Ask Mode Output</label>
                <span class="sub-label">How to deliver answers when using Ask Mode (Ctrl+Alt+A)</span>
                <select id="ask-output-mode-select">
                    <option value="type">Type (Inject text)</option>
                    <option value="clipboard">Clipboard Only</option>
                    <option value="notification">Notification Only</option>
                    <option value="clipboard+notify">Clipboard + Notification Both</option>
                </select>
            </div>

            <div class="setting-group">
                <label>Mode Configuration</label>
                <span class="sub-label">Customize model and system prompt for each mode</span>

                <!-- Master-Detail Layout -->
                <div
                    style="display: grid; grid-template-columns: 200px 1fr; gap: 20px; margin-top: 15px; min-height: 400px;">
                    <!-- LEFT: Mode List -->
                    <div id="mode-list" style="display: flex; flex-direction: column; gap: 8px;">
                        <div class="mode-list-item active" data-mode="standard">
                            Standard
                        </div>
                        <div class="mode-list-item" data-mode="prompt">
                            Prompt
                        </div>
                        <div class="mode-list-item" data-mode="professional">
                            Professional
                        </div>
                        <div class="mode-list-item" data-mode="raw">
                            Raw
                        </div>
                    </div>

                    <!-- RIGHT: Mode Details -->
                    <div id="mode-detail"
                        style="background: #1a1a1a; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <h3 id="mode-detail-title" style="margin: 0 0 20px 0;">Standard</h3>

                        <!-- Model Selection -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Model Override</label>
                            <select id="mode-detail-model"
                                style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid var(--border-color); border-radius: 4px; color: #e0e0e0;">
                                <option value="">Use default model</option>
                            </select>
                            <span style="display: block; margin-top: 4px; color: #888; font-size: 0.85em;">Leave empty
                                to use app default model</span>
                        </div>

                        <!-- System Prompt -->
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">System Prompt</label>
                            <textarea id="mode-detail-prompt"
                                placeholder="Leave empty to use default prompt. Must contain {text} placeholder."
                                style="width: 100%; height: 200px; padding: 10px; background: #0a0a0a; border: 1px solid var(--border-color); border-radius: 4px; color: #e0e0e0; font-family: 'Courier New', monospace; font-size: 0.9em; resize: vertical;">
                            </textarea>
                            <span style="display: block; margin-top: 4px; color: #888; font-size: 0.85em;"
                                id="prompt-info">Custom prompt (leave empty for default)</span>
                        </div>

                        <!-- Action Buttons -->
                        <div
                            style="display: flex; gap: 10px; margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
                            <button id="save-mode-btn" class="btn" style="flex: 1; background: #059669;">
                                Save Changes
                            </button>
                            <button id="reset-mode-btn" class="btn btn-secondary" style="flex: 1;">
                                Reset to Default
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Injection Configuration (SPEC_006) -->
            <div class="setting-group">
                <label>Text Injection Settings</label>
                <span class="sub-label">Customize how text is injected after dictation</span>

                <!-- 1. Trailing Space Configuration -->
                <div style="margin-bottom: 16px;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #1a2f1f; border: 1px solid #10b981; border-radius: 6px;">
                        <div>
                            <label style="font-weight: 500; margin: 0; color: #10b981;">Add Trailing Space</label>
                            <span
                                style="display: block; color: #a7f3d0; font-size: 0.9em; margin-top: 4px;">Automatically
                                add a space after dictation for natural spacing</span>
                        </div>
                        <label class="toggle-switch" style="margin: 0;">
                            <input type="checkbox" id="trailing-space-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- 2. Optional Keys Section -->
                <div
                    style="background: linear-gradient(135deg, #1a1a2f 0%, #0f0f1f 100%); border: 1px solid #60a5fa; border-radius: 8px; padding: 14px; margin-top: 16px;">
                    <h3 style="margin: 0 0 12px 0; font-size: 1em; color: #60a5fa;">Advanced: Optional Keys After Text
                    </h3>
                    <span style="display: block; color: #888; font-size: 0.9em; margin-bottom: 12px;">Optionally press
                        an additional key (Enter, Tab) after the space for specific use cases</span>

                    <!-- Enable/Disable Optional Key Toggle -->
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding: 10px; background: #0a0a0a; border: 1px solid var(--border-color); border-radius: 6px;">
                        <div>
                            <label style="font-weight: 500; margin: 0;">Enable Additional Key</label>
                            <span style="display: block; color: #888; font-size: 0.9em; margin-top: 3px;">Quick toggle
                                for optional Enter/Tab key</span>
                        </div>
                        <label class="toggle-switch" style="margin: 0;">
                            <input type="checkbox" id="additional-key-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Key Selection Dropdown -->
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-weight: 500;">Select Key to Press</label>
                        <select id="additional-key-select"
                            style="width: 100%; padding: 8px; background: #0a0a0a; border: 1px solid var(--border-color); border-radius: 4px; color: #e0e0e0;">
                            <option value="none">None (Space Only)</option>
                            <option value="enter">Enter (Auto-Send Messages)</option>
                            <option value="tab">Tab (Move to Next Field)</option>
                        </select>
                    </div>

                    <!-- Use Cases -->
                    <div
                        style="background: #0a1a0a; border-left: 3px solid #10b981; padding: 10px 12px; border-radius: 4px; font-size: 0.9em; margin-bottom: 12px;">
                        <strong style="color: #10b981;">Common Use Cases:</strong>
                        <ul style="margin: 6px 0 0 0; padding-left: 18px; color: #888; line-height: 1.5;">
                            <li><strong>Enter key:</strong> Chat apps (Discord, Slack) - auto-send messages</li>
                            <li><strong>Tab key:</strong> Forms, search boxes - move to next field or trigger
                                autocomplete</li>
                            <li><strong>Space only:</strong> General writing, documents - natural spacing without
                                auto-actions</li>
                        </ul>
                    </div>

                    <!-- Safety Warning -->
                    <div
                        style="background: #1a1410; border: 1px solid #fbbf24; border-radius: 4px; padding: 10px; font-size: 0.9em; color: #aaa;">
                        <strong style="color: #fbbf24;">Important:</strong> The additional key feature is OFF by
                        default. If enabled, verify the key works correctly in your target application before relying on
                        it. Use Enter carefully in chat apps to avoid accidental message sends.
                    </div>
                </div>
            </div>

            <!-- Styles for mode list -->
            <style>
                .mode-list-item {
                    padding: 10px 12px;
                    background: var(--jet-black);
                    border: 1px solid var(--border-color);
                    border-radius: 4px;
                    cursor: pointer;
                    transition: all 0.2s;
                    text-align: center;
                    font-weight: 500;
                    user-select: none;
                }

                .mode-list-item:hover {
                    background: var(--dark-teal);
                    color: white;
                }

                .mode-list-item.active {
                    background: var(--dark-teal-3);
                    color: white;
                    border-color: var(--dark-teal-3);
                    box-shadow: 0 0 8px rgba(0, 96, 122, 0.5);
                }
            </style>
        </div>


        <!-- API KEYS TAB -->
        <div id="apikeys" class="tab-content">
            <h2>API Keys</h2>

            <!-- Security Callout -->
            <div
                style="background: linear-gradient(135deg, #1a2f1a 0%, #0f1f0f 100%); border: 1px solid #22c55e; border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <span style="font-size: 2em;">üîê</span>
                    <div>
                        <h3 style="margin: 0 0 8px 0; color: #4ade80; font-size: 1.1em;">Your Keys Are Secure</h3>
                        <ul style="margin: 0; padding-left: 18px; color: #a3e635; font-size: 0.9em; line-height: 1.6;">
                            <li><strong>OS-Level Encryption</strong> - Keys are encrypted using Windows Credential
                                Manager (DPAPI)</li>
                            <li><strong>Stored Locally</strong> - Never uploaded to any server or cloud service</li>
                            <li><strong>App-Specific</strong> - Only dIKtate can decrypt your keys</li>
                            <li><strong>Deletable Anytime</strong> - Remove keys instantly with the delete button</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Gemini -->
            <div class="setting-group" id="gemini-key-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>Gemini API Key</label>
                    <span id="gemini-status" class="key-status"></span>
                </div>
                <div id="gemini-input-row" style="display: flex; gap: 10px;">
                    <input type="password" id="gemini-api-key" placeholder="Enter Gemini API key" style="flex: 1;">
                    <button id="test-gemini-btn" class="btn btn-secondary">Test</button>
                    <button id="save-gemini-btn" class="btn btn-secondary">Save</button>
                </div>
                <div id="gemini-saved-row"
                    style="display: none; padding: 10px; background: #1a3a1a; border: 1px solid #22c55e; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #4ade80;">‚úì API Key Saved</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="test-gemini-saved-btn" class="btn btn-secondary">Test</button>
                            <button id="delete-gemini-btn" class="btn btn-danger">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </div>
                <span class="sub-label">Get your key from <a href="#" id="gemini-docs-link"
                        data-external-link="https://aistudio.google.com/apikey">Google AI Studio</a></span>
            </div>

            <!-- Anthropic -->
            <div class="setting-group" id="anthropic-key-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>Anthropic API Key</label>
                    <span id="anthropic-status" class="key-status"></span>
                </div>
                <div id="anthropic-input-row" style="display: flex; gap: 10px;">
                    <input type="password" id="anthropic-api-key" placeholder="Enter Anthropic API key"
                        style="flex: 1;">
                    <button id="test-anthropic-btn" class="btn btn-secondary">Test</button>
                    <button id="save-anthropic-btn" class="btn btn-secondary">Save</button>
                </div>
                <div id="anthropic-saved-row"
                    style="display: none; padding: 10px; background: #1a3a1a; border: 1px solid #22c55e; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #4ade80;">‚úì API Key Saved</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="test-anthropic-saved-btn" class="btn btn-secondary">Test</button>
                            <button id="delete-anthropic-btn" class="btn btn-danger">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </div>
                <span class="sub-label">Get your key from <a href="#" id="anthropic-docs-link"
                        data-external-link="https://console.anthropic.com/">Anthropic Console</a></span>
            </div>

            <!-- OpenAI -->
            <div class="setting-group" id="openai-key-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>OpenAI API Key</label>
                    <span id="openai-status" class="key-status"></span>
                </div>
                <div id="openai-input-row" style="display: flex; gap: 10px;">
                    <input type="password" id="openai-api-key" placeholder="Enter OpenAI API key" style="flex: 1;">
                    <button id="test-openai-btn" class="btn btn-secondary">Test</button>
                    <button id="save-openai-btn" class="btn btn-secondary">Save</button>
                </div>
                <div id="openai-saved-row"
                    style="display: none; padding: 10px; background: #1a3a1a; border: 1px solid #22c55e; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #4ade80;">‚úì API Key Saved</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="test-openai-saved-btn" class="btn btn-secondary">Test</button>
                            <button id="delete-openai-btn" class="btn btn-danger">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                </div>
                <span class="sub-label">Get your key from <a href="#" id="openai-docs-link"
                        data-external-link="https://platform.openai.com/api-keys">OpenAI Platform</a></span>
            </div>
        </div>

        <!-- ABOUT TAB -->
        <div id="about" class="tab-content">
            <h2>About dIKtate</h2>
            <p><strong>Version:</strong> <span id="app-version">0.1.0-mvp</span></p>
            <p>dIKtate is a privacy-first, local voice dictation tool designed for professionals.</p>

            <div style="margin-top: 20px; padding: 15px; background: #252526; border-radius: 5px;">
                <p><strong>License:</strong> MIT</p>
                <p><strong>Copyright:</strong> ¬© 2026 dIKtate Contributors</p>
            </div>

            <div style="margin-top: 20px;">
                <button id="website-link" class="btn">Visit Website</button>
                <button id="github-link" class="btn btn-secondary">GitHub</button>
            </div>
        </div>
    </div>

    <!-- Restart Required Modal -->
    <div id="restart-modal" class="modal-overlay">
        <div class="modal">
            <h3>üîÑ Restart Required</h3>
            <p>Changing models requires a full application restart to ensure the new model is loaded correctly and
                cleanly into memory.</p>
            <div class="modal-buttons">
                <button id="modal-cancel-btn" class="btn btn-secondary">Later</button>
                <button id="modal-restart-btn" class="btn"
                    style="background: #fca311; color: black; font-weight: bold;">Restart Now</button>
            </div>
        </div>
    </div>

    <script src="./settings.js"></script>
</body>

</html>